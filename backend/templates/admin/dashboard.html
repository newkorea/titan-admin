<%inherit file="admin_frame.html"/>

<%block name="title">시작하기</%block>
<%block name="subtitle">타이탄 관리자 사이트에 오신걸 환영합니다</%block>

<%block name="css"></%block>

<%block name="content">
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-body">
        <div>안녕하세요. 관리자 대시보드입니다.</div>
        <div>최근 24시간 운영 현황을 요약해서 보여드립니다: 로그인 시도, 서버 접속 실패, 강제 종료 Top 10.</div>
      </div>
    </div>
  </div>
  </div>

  <!-- PING < 0 서버 목록 -->
  <div class="row mt-3">
    <div class="col-12">
      <div class="card">
        <div class="card-header"><b>네트워크 점검 필요: PING < 0 서버</b></div>
        <div class="card-body p-0">
          <table class="table table-sm mb-0">
            <thead>
              <tr>
                <th style="width: 90px;">ID</th>
                <th>이름</th>
                <th>도메인</th>
                <th>IP</th>
                <th style="width: 100px;">통신사</th>
                <th style="width: 90px;">PING</th>
              </tr>
            </thead>
            <tbody>
              % for r in bad_ping_agents or []:
              <tr>
                <td>${r['id']}</td>
                <td>${r.get('name','')}</td>
                <td>${r.get('hostdomain','')}</td>
                <td>${r.get('hostip','')}</td>
                <td>${r.get('telecom','')}</td>
                <td><span class="badge badge-danger">${r.get('ping','')}</span></td>
              </tr>
              % endfor
              % if not bad_ping_agents:
              <tr><td colspan="6" class="text-center">모든 서버가 정상 응답 중입니다</td></tr>
              % endif
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
<!-- 결제 요약 섹션 제거 (요구사항에 따라 비활성화) -->

<!-- 최근 24시간 Top 10 통계 -->
<div class="row mt-3">
  <!-- 로그인 시도 Top 10 -->
  <div class="col-md-4">
    <div class="card">
      <div class="card-header"><b>최근 24시간 로그인 시도 Top 10</b></div>
      <div class="card-body p-0">
        <table class="table table-sm mb-0">
          <thead>
            <tr>
              <th style="width: 50px;">순위</th>
              <th>이메일</th>
              <th style="width: 90px;" class="text-right">건수</th>
            </tr>
          </thead>
          <tbody>
            % for i, r in enumerate(top_login_24h or [], start=1):
            <tr>
              <td>${i}</td>
              <td><a href="/device_info" target="_blank">${r['email']}</a></td>
              <td class="text-right">${r['cnt']}</td>
            </tr>
            % endfor
            % if not top_login_24h:
            <tr><td colspan="3" class="text-center">데이터가 없습니다</td></tr>
            % endif
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- 서버 접속 실패 Top 10 -->
  <div class="col-md-4">
    <div class="card">
      <div class="card-header"><b>최근 24시간 서버 접속 실패 Top 10</b></div>
      <div class="card-body p-0">
        <table class="table table-sm mb-0">
          <thead>
            <tr>
              <th style="width: 50px;">순위</th>
              <th>이메일</th>
              <th style="width: 90px;" class="text-right">건수</th>
            </tr>
          </thead>
          <tbody>
            % for i, r in enumerate(top_failed_24h or [], start=1):
            <tr>
              <td>${i}</td>
              <td><a href="/failed_info" target="_blank">${r['email']}</a></td>
              <td class="text-right">${r['cnt']}</td>
            </tr>
            % endfor
            % if not top_failed_24h:
            <tr><td colspan="3" class="text-center">데이터가 없습니다</td></tr>
            % endif
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- 강제 종료 Top 10 -->
  <div class="col-md-4">
    <div class="card">
      <div class="card-header"><b>최근 24시간 강제 종료 Top 10</b></div>
      <div class="card-body p-0">
        <table class="table table-sm mb-0">
          <thead>
            <tr>
              <th style="width: 50px;">순위</th>
              <th>이메일</th>
              <th style="width: 90px;" class="text-right">건수</th>
            </tr>
          </thead>
          <tbody>
            % for i, r in enumerate(top_force_24h or [], start=1):
            <tr>
              <td>${i}</td>
              <td><a href="/disconnection_info" target="_blank">${r['email']}</a></td>
              <td class="text-right">${r['cnt']}</td>
            </tr>
            % endfor
            % if not top_force_24h:
            <tr><td colspan="3" class="text-center">데이터가 없습니다</td></tr>
            % endif
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
</%block>

<%block name="js">
</%block>
